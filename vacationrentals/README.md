
*Vacation rentals*

The task is to build a RESTful web service for Vacation Rentals properties.

The web service has been built using [__http4s__](https://github.com/http4s/http4s), a minimal, idiomatic Scala interface 
for HTTP services and [__sbt__](https://www.scala-sbt.org/1.x/docs/Installing-sbt-on-Mac.html), (sorry, not maven), to install sbt on a Mac:

Homebrew 
```bash
$ brew install sbt@1
```
Macports 
```bash
$ port install sbt
```


Assumptions:

- When adding a new property, all fields are mandatory, except __postalCode__ and __state__, which are optional.
- The country codes are ISO alpha-2 codes, currently only country codes UK and US are supported, for illustration purposes, 
  as __countryCode__ was modeled as an enum. 
- The listing IDs are randomly generated by the service as UUIDs, in case of collisions it will try for 10 consecutive times
  (should be a timeout in a real life app)


Run:

- `sbt run`
- To add a listing: `curl -X POST -H "Content-Type: application/json" -d '{
                                                                   "contact": {
                                                                     "phone": "15126841100",
                                                                     "formattedPhone": "+1 512-684-1100"
                                                                   },
                                                                   "address": {
                                                                     "address": "1011 W 5th St",
                                                                     "postalCode": "1011",
                                                                     "countryCode": "US",
                                                                     "city": "Austin",
                                                                     "state": "TX",
                                                                     "country": "United States"
                                                                   },
                                                                   "location": {
                                                                     "lat": 40.4255485534668,
                                                                     "lng": -3.7075681686401367
                                                                   }
                                                                   }' http://localhost:8080/listings`
  this returns the just added listing ID.
- To retrieve a listing use the ID generated above, e.g.: `curl localhost:8080/listings/22f82183-b171-430e-bf9e-4102efbacab3`
- To update a listing: `curl -X PUT -H "Content-Type: application/json" -d '{
                                                                  "id": "22f82183-b171-430e-bf9e-4102efbacab3",
                                                                  "contact": {
                                                                    "phone": "15126846666",
                                                                    "formattedPhone": "+1 512-684-6666"
                                                                  },
                                                                  "address": {
                                                                    "address": "1011 W 5th St",
                                                                    "postalCode": "1011",
                                                                    "countryCode": "US",
                                                                    "city": "Pensacola",
                                                                    "state": "FL",
                                                                    "country": "United States"
                                                                  },
                                                                  "location": {
                                                                    "lat": 40.4255485534668,
                                                                    "lng": -3.7075681686401367
                                                                  }
                                                                  }' http://localhost:8080/listings`
- To delete a listing: `curl -X "DELETE" localhost:8080/listings/22f82183-b171-430e-bf9e-4102efbacab3`
- to run the tests, `sbt test`


Notes:

- Using a scala.collection.concurrent.TrieMap as the underlying in memory storage to allow efficient concurrent changes
- If some listings are accessed much more often than others, use cache with expiry for most frequently accessed urls 
  (LRU, Map + LinkedHashMap) 
- Once deployed to, let's say AWS, should use an ELB to distribute the load horizontally among the machines
- Random UUIDS make collisions are highly unlikely, but there is a possibility, so introduced a timeout.
- The app should scale using the in-memory repository, if this were not enough due to memory constraints, can use a 
  distributed sharded repository: hash key based. 
- TODO: use an accumulating circe json decoder, which using ValidatedNEL cna show the user a list of possible errors in
  the json, rather than failing fast.
- TODO: add more unit tests.
- TODO: __state__ should be an Option of an enum as well.
